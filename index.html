<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Land Price Rate Generator</title>
    <!-- Dependencies -->
    <script src="lib/plotly.min.js"></script>
    <script src="lib/papaparse.min.js"></script>
    <script src="lib/xlsx.full.min.js"></script>
    <script src="lib/jszip.min.js"></script>
    <script src="lib/file-saver.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-slate-50 text-slate-800 h-screen flex flex-col overflow-hidden">
    

    <!-- Floating Deploy Button -->
    <button class="deploy-float-btn" id="deployFloatBtn" data-i18n-title="deployTooltip" title="Download full project for GitHub Pages" disabled=""><span class="loader border-2 border-white/50 border-t-white w-4 h-4 rounded-full animate-spin"></span></button>

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between flex-shrink-0 z-10 shadow-sm pr-40 sm:pr-6">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-blue-600 text-white rounded-lg shadow-sm">
                <span class="material-symbols-outlined text-2xl">show_chart</span>
            </div>
            <div>
                <h1 class="text-xl font-bold text-slate-900 leading-tight" data-i18n="title">Land Price Rate Generator</h1>
                <p class="text-xs text-slate-500 font-medium" data-i18n="subtitle">Land Price Rate PCHIP Generator</p>
            </div>
        </div>
        
        <div class="flex items-center gap-4">
            <!-- Info Badge (Hidden on mobile) -->
            <div class="hidden lg:flex items-center gap-2 text-sm text-slate-500 bg-slate-100 px-3 py-1.5 rounded-full border border-slate-200">
                <span class="material-symbols-outlined text-base">info</span>
                <span data-i18n="headerInfo">PCHIP Monotone Interpolation | Step 1 Lookup (300-800)</span>
            </div>

            <!-- Language Toggle -->
            <button class="lang-btn flex items-center gap-1.5" id="langToggle">
                <span class="material-symbols-outlined text-lg">language</span>
                <span id="currentLangLabel">中文</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        <!-- Left Panel: Controls -->
        <aside class="w-full lg:w-[420px] bg-white border-r border-slate-200 flex flex-col overflow-y-auto z-0 shadow-[4px_0_24px_rgba(0,0,0,0.02)]">
            <div class="p-6 space-y-8">
                <!-- Data Upload -->
                <section class="space-y-4">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-600 text-xs font-bold">1</span>
                        <h2 class="text-sm font-bold uppercase tracking-wider text-slate-700" data-i18n="step1">1. Upload Land Data</h2>
                    </div>
                    <div class="relative group">
                        <input accept=".csv, .xlsx, .xls" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" id="fileInput" type="file">
                        <div class="border-2 border-dashed border-slate-300 rounded-xl p-6 flex flex-col items-center justify-center text-center transition-colors group-hover:border-blue-500 group-hover:bg-blue-50/50">
                            <span class="material-symbols-outlined text-4xl text-slate-400 mb-2 group-hover:text-blue-500">cloud_upload</span>
                            <p class="text-sm font-medium text-slate-700" data-i18n="uploadText">Click or Drag to Upload</p>
                            <p class="text-xs text-slate-500 mt-1" data-i18n="uploadHint">Supports CSV or Excel (1st column: Land Size)</p>
                        </div>
                    </div>
                    <!-- Manual Input -->
                    <div class="border border-slate-200 rounded-lg overflow-hidden">
                        <button class="w-full flex items-center justify-between px-4 py-2 bg-slate-50 hover:bg-slate-100 text-xs font-medium text-slate-600 transition-colors" id="toggleManualInput">
                            <span data-i18n="manualInput">Or Manual Input (One per line)</span>
                            <span class="material-symbols-outlined text-base transition-transform" id="manualIcon">expand_more</span>
                        </button>
                        <div class="hidden p-3 bg-white border-t border-slate-200" id="manualInputContainer">
                            <textarea class="w-full text-xs p-2 border border-slate-200 rounded focus:ring-2 focus:ring-blue-500 outline-none" id="manualDataInput" data-i18n-placeholder="manualInputPlaceholder" rows="3" placeholder="100
200
350"></textarea>
                            <button class="mt-2 w-full py-1.5 bg-slate-700 text-white text-xs rounded hover:bg-slate-800 transition-colors" id="processManualData" data-i18n="confirmInput">Confirm Input</button>
                        </div>
                    </div>
                    <!-- Data Status -->
                    <div class="hidden space-y-3 bg-slate-50 p-4 rounded-xl border border-slate-200" id="dataStatus">
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div class="bg-white p-2 rounded border border-slate-100">
                                <div class="text-[9px] text-slate-400 font-bold uppercase" data-i18n="statCount">Count</div>
                                <div class="text-xs font-bold text-slate-700" id="statCount">-</div>
                            </div>
                            <div class="bg-white p-2 rounded border border-slate-100">
                                <div class="text-[9px] text-slate-400 font-bold uppercase">MIN</div>
                                <div class="text-xs font-bold text-emerald-600" id="statMin">-</div>
                            </div>
                            <div class="bg-white p-2 rounded border border-slate-100">
                                <div class="text-[9px] text-slate-400 font-bold uppercase">MAX</div>
                                <div class="text-xs font-bold text-blue-600" id="statMax">-</div>
                            </div>
                        </div>
                        <div class="font-mono text-[10px] text-slate-500 h-16 overflow-y-auto custom-scrollbar bg-white border border-slate-100 p-2 rounded" id="previewData"></div>
                    </div>
                </section>
                <hr class="border-slate-100">
                <!-- Anchor Points -->
                <section class="space-y-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-2">
                            <span class="flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 text-blue-600 text-xs font-bold">2</span>
                            <h2 class="text-sm font-bold uppercase tracking-wider text-slate-700" data-i18n="step2">2. Anchor Points</h2>
                        </div>
                        <button class="text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 font-medium bg-blue-50 px-2 py-1 rounded transition-colors" id="addAnchorBtn">
                            <span class="material-symbols-outlined text-sm">add</span> <span data-i18n="addAnchor">Add</span>
                        </button>
                    </div>
                    <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                        <div class="grid grid-cols-[1fr_1fr_40px] bg-slate-50 border-b border-slate-200 text-[10px] uppercase font-bold text-slate-500 py-2 px-3">
                            <div data-i18n="landSize">Land Size</div>
                            <div data-i18n="priceRate">Price Rate</div>
                            <div></div>
                        </div>
                        <div class="divide-y divide-slate-100 max-h-[220px] overflow-y-auto custom-scrollbar" id="anchorsContainer"><div class="grid grid-cols-[1fr_1fr_40px] px-3 py-1.5 border-b border-slate-50 items-center gap-2 hover:bg-slate-50 transition-colors">
                    <input type="number" step="any" value="100" onchange="updateAnchor(0, 'size', this.value)" class="w-full text-xs p-1.5 border border-slate-100 rounded focus:border-blue-400 outline-none" placeholder="Size">
                    <input type="number" step="any" value="1000" onchange="updateAnchor(0, 'rate', this.value)" class="w-full text-xs p-1.5 border border-slate-100 rounded focus:border-blue-400 outline-none" placeholder="Rate">
                    <button onclick="removeAnchor(0)" class="text-slate-300 hover:text-red-500 transition-colors flex justify-center" disabled="">
                        <span class="material-symbols-outlined text-base">delete</span>
                    </button>
                </div><div class="grid grid-cols-[1fr_1fr_40px] px-3 py-1.5 border-b border-slate-50 items-center gap-2 hover:bg-slate-50 transition-colors">
                    <input type="number" step="any" value="1000" onchange="updateAnchor(1, 'size', this.value)" class="w-full text-xs p-1.5 border border-slate-100 rounded focus:border-blue-400 outline-none" placeholder="Size">
                    <input type="number" step="any" value="500" onchange="updateAnchor(1, 'rate', this.value)" class="w-full text-xs p-1.5 border border-slate-100 rounded focus:border-blue-400 outline-none" placeholder="Rate">
                    <button onclick="removeAnchor(1)" class="text-slate-300 hover:text-red-500 transition-colors flex justify-center" disabled="">
                        <span class="material-symbols-outlined text-base">delete</span>
                    </button>
                </div></div>
                    </div>
                </section>
                <!-- Action Button -->
                <div class="pt-4 pb-12">
                    <button class="w-full py-4 bg-blue-600 hover:bg-blue-700 active:scale-[0.98] text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 transition-all flex items-center justify-center gap-2" id="generateBtn">
                        <span class="material-symbols-outlined">insights</span>
                        <span data-i18n="generateCurve">Generate PCHIP Curve</span>
                    </button>
                </div>
            </div>
        </aside>
        <!-- Right Panel: Result Display -->
        <section class="flex-1 bg-slate-50 flex flex-col relative overflow-hidden">
            <!-- Visualization -->
            <div class="flex-1 p-4 lg:p-6 flex flex-col min-h-0">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex-1 relative flex flex-col overflow-hidden">
                    <div class="px-5 py-4 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="text-sm font-bold text-slate-700 flex items-center gap-2">
                            <span class="material-symbols-outlined text-blue-500">analytics</span>
                            <span data-i18n="chartSectionTitle">Visualization</span>
                        </h3>
                        <div class="flex gap-4">
                            <span class="flex items-center gap-1.5 text-[11px] text-slate-500 font-medium">
                                <span class="w-2.5 h-2.5 rounded-full bg-blue-600"></span> <span data-i18n="legendCurve">Curve</span>
                            </span>
                            <span class="flex items-center gap-1.5 text-[11px] text-slate-500 font-medium">
                                <span class="w-2.5 h-2.5 rounded-full bg-red-500"></span> <span data-i18n="legendAnchor">Anchors</span>
                            </span>
                        </div>
                    </div>
                    <div class="flex-1 w-full" id="chartDiv"></div>
                    <!-- Empty Overlay -->
                    <div class="absolute inset-0 bg-white z-10 flex flex-col items-center justify-center text-slate-400" id="emptyState">
                        <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-4">
                            <span class="material-symbols-outlined text-4xl">stacked_line_chart</span>
                        </div>
                        <p class="font-medium" data-i18n="emptyState">Upload data to generate chart</p>
                    </div>
                </div>
            </div>
            <!-- Download Panel -->
            <div class="p-4 lg:p-6 pt-0 invisible opacity-0 translate-y-4 transition-all duration-500" id="resultsPanel">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-5 space-y-5">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                        <div class="flex gap-8">
                            <div>
                                <div class="text-[10px] text-slate-400 font-bold uppercase mb-1" data-i18n="avgRateTitle">Average Price Rate</div>
                                <div class="flex items-baseline gap-1.5">
                                    <span class="text-2xl font-black text-slate-800" id="resAvgRate">-</span>
                                    <span class="text-xs text-slate-500">/area</span>
                                </div>
                            </div>
                            <div class="flex gap-8 border-l border-slate-100 pl-8">
                                <div>
                                    <div class="text-[10px] text-slate-400 font-bold uppercase mb-1" data-i18n="resDataCount">Data Points</div>
                                    <div class="text-lg font-bold text-slate-700" id="resDataCount">-</div>
                                </div>
                                <div>
                                    <div class="text-[10px] text-slate-400 font-bold uppercase mb-1" data-i18n="resAnchorCount">Anchors</div>
                                    <div class="text-lg font-bold text-slate-700" id="resAnchorCount">-</div>
                                </div>
                            </div>
                        </div>
                        <!-- Download Options -->
                        <div class="flex flex-wrap gap-2">
                            <button class="flex-1 sm:flex-none px-4 py-2.5 bg-slate-800 hover:bg-slate-900 text-white text-xs font-bold rounded-lg flex items-center justify-center gap-2 transition-colors" id="downloadResultsBtn">
                                <span class="material-symbols-outlined text-base">download</span> <span data-i18n="downloadResults">Download Results (CSV)</span>
                            </button>
                            <button class="flex-1 sm:flex-none px-4 py-2.5 bg-white border border-slate-200 hover:border-slate-300 text-slate-700 text-xs font-bold rounded-lg flex items-center justify-center gap-2 transition-colors" id="downloadLookupBtn">
                                <span class="material-symbols-outlined text-base text-blue-600">table_chart</span> <span data-i18n="downloadLookup">Download Lookup (CSV)</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="js/main.js"></script>



</body>
</html>